<!doctype html>
<html>
  <head>
    <title>Simple Tiles</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<!--
+-----------------------------+
|^^^^                      / ~|
|^^^            ----------   /|
|^^   Simple  /    ---------  |
|            / ~ / **         |
|           /   / ****        |
|      ----  ~ / ******       |
|     / ~~  -- *******        |
|    /    /    *****          |
|   /    /                    |
|  / ~~ /       Tiles   ^^^^ ^|
|-     /                ^^^ ^^|
| ~~~ /                 ^^ ^^^|
+-----------------------------+

documentation layout inspired by backbone and underscore, obvs
-->
    <style>
      /* reset */
      div, html, body {
        margin: 0;
        padding: 0;
        border: 0;
        vertical-align: baseline;
      }

      ul { list-style: none; padding-left: 10px;}
      li { margin-bottom: 1em; }
      /* text styles */
      body {
        font-family: "Helvetica Nueue", Helvetica, sans-serif;
        font-size: 14px;
        line-height: 1.7em;
        width: 600px;
        margin-left: 220px;
        padding: 20px;
      }
      p { margin: 0px 0px 1em; }

      h1, h2, h3 {
        text-rendering: optimizeLegibility;
        margin-left: -5px;
      }
      h4 {
        margin: 0px;
        margin-left: -4px;
        font-weight: normal;
      }
      code, pre, tt { font-family: Monaco, monospace; font-size: 12px; }
      tt { border:1px solid #cdcdcd; padding: 2px;}
      a { color: black; }
      a:hover { text-decoration: none; }
      pre {
        padding-left: 10px;
        font-size: 12px;
        border-left: 5px solid #efefef;
      }

      hr {
        border: 0;
        border-top: 1px solid #efefef;
        height: 1px;
      }

      /* layout */
      #sidebar {
        top:0;
        left:0;
        bottom:0;
        position:fixed;
        padding: 20px;
        width: 180px;
        border-right: 1px solid #efefef;
      }

      #sidebar a { font-weight: bold; }

      #sidebar li a {
        font-weight: normal;
        text-decoration:none;
      }

      #sidebar li a:hover { text-decoration: underline; }

      #sidebar li {
        font-size: 12px;
        margin-left: 5px;
        margin-bottom: 0;
      }

      #sidebar h4 { margin: 0.7em 0;}

      /* lion-roar scrolling */
      #sidebar::-webkit-scrollbar {
        width: 6px;
        height: 6px;
        z-index: 999;
      }

      #sidebar::-webkit-scrollbar-button:start:decrement,
      #sidebar::-webkit-scrollbar-button:end:increment {
        display: block;
        height:3px;
      }

      #sidebar::-webkit-scrollbar-thumb:vertical {
        height: 20px;
        background-color: rgba(0,0,0,0.3);
        -webkit-border-radius: 5px;
        -webkit-box-shadow: 0 1px 1px rgba(255,255,255,0.9);
        padding-right:0px;
      }

      #sidebar::-webkit-scrollbar-track:enabled {
        background-color: transparent;
        width:10px;
      }

      #sidebar::-webkit-scrollbar-track-piece {
        background-color: transparent;
        border: none;
        margin: 0 5px 0px 0;
      }
    </style>
  </head>

  <body>
    <div id="sidebar">
      <h4><a href="#dependencies">Dependencies</a></h4>
      <h4><a href="#installation">Installation</a></h4>
      <h4><a href="#compilation">Compilation & Linking</a></h4>
      <h4><a href="#overview">Overview</a></h4>
      <hr>
      <h4><a href="#simplet_map_t">Maps</a></h4>
      <ul>
        <li><a href="#simplet_map_new">simplet_map_new</a></li>
        <li><a href="#simplet_map_free">simplet_map_free</a></li>
        <li><a href="#simplet_map_set_srs">simplet_map_set_srs</a></li>
      </ul>
    </div>
    <img src="docs/simple-tiles-logo.png">
    <p><a href="http://github.com/propublica/simple-tiles">Simple Tiles</a>
    is an image generation library for spatial data written in C. At it's
    core it is a thin wrapper on top of <a href="http://www.gdal.org/ogr">OGR</a>
    for spatial data and <a href="http://cairographics.org">Cairo</a>
    for image generation.</p>

    <p>The library's source is over at <a href="http://github.com/propublica/simple-tiles">github</a>
    and there is an <a href="docs/map.html">annotated version</a> available. Please report
    issues or ask questions in the
    <a href="https://github.com/propublica/simple-tiles/issues">issue tracker</a>.</p>

    <p>There are currently Ruby bindings in
    <a href="http://github.com/propublica/simpler-tiles">Simpler Tiles</a>.</p>

    <h2 id="dependencies">Dependencies</h2>
    <p>Simple Tiles relies on GDAL and OGR for abstractions over geospatial data. You'll
    need at least version 1.8.0 to use the library. On Ubuntu you can install
    the library using the <a href="https://launchpad.net/~ubuntugis/+archive/ppa/">ubuntugis ppa</a>.
    On OS X the version from homebrew works well.
    </p>

    <p>Simple Tiles uses <a href="http://cairographics.org">Cairo</a> and
    <a href="http://developer.gnome.org/pango/stable/">Pango</a>  for the final
    png output, you'll need an installed and working version of both. On Ubuntu
    apt-get installs a perfectly fine version of both, and OS X users can use homebrew.
    </p>

    <h2 id="installation">Installation</h2>
    <p>To install Simple Tiles run:</p>
<pre>
$ git clone git@github.com:propublica/simple-tiles.git
$ cd simple-tiles
$ make && make install
</pre>
    <p>You'll probably also want to run:</p>
<pre>
$ make test
</pre>
    <p>to ensure the library and its dependencies are playing nice with one another.</p>

    <h2 id="compilation">Compilation and Linking</h2>
    <p>Once you have a working copy of Simple Tiles, you'll want to use <b>pkg-config</b>
    to link to the library. For example, to compile a file with Simple Tiles use:</p>
<pre>
cc `pkg-config --cflags simple-tiles` `gdal-config --cflags` -c -o main.o main.c
cc main.o `pkg-config --libs simple-tiles` `gdal-config --libs` -o main
</pre>
    <p>And your program should be linked correctly.</p>

    <h2 id="overview">Overview</h2>
    <p>Simple Tiles is written in an object oriented fashion with thin data structures.
      The heirarchy of <a href="docs/types_h.html">structures</a> consists of:</p>
    <ul>
      <li>
        <tt>simplet_map_t</tt>: Each <tt>simplet_map_t</tt> stores the projection,
        bounds, the width and height of the desired image, and a list of
        <tt>simplet_layer_t</tt> instances.
      </li>
      <li>
        <tt>simplet_layer_t</tt>: Each <tt>simplet_layer_t</tt> contains an
        <a href="http://www.gdal.org/ogr/ogr_formats.html">OGR</a> compatible
        datasource string, and stores a list of <tt>simplet_filter_t</tt> instances.
        Layers define access to spatial storage either from physical files or
        databases. Each contains a list of <tt>simplet_filter_t</tt> structures.
      </li>
      <li>
        <tt>simplet_filter_t</tt>: A <tt>simplet_filter_t</tt> instance stores
        <a href="http://www.gdal.org/ogr/ogr_sql.html">ogrsql</a>
        to filter the data on its parent's <tt>simplet_layer_t</tt> datasource.
        Each filter contains a list of <tt>simplet_style_t</tt> structures.
      </li>
      <li>
        <tt>simplet_style_t</tt>: A <tt>simplet_style_t</tt> instance stores information
        on how to style and display each data row returned from filters.
      </li>
    </ul>

    <p>
      For a real-world example on how this all fits together, here is
      a demo that draws the map in the Simple Tiles logo:
    </p>
<pre>
#include &lt;simple-tiles/simple_tiles.h&gt;
#include &lt;simple-tiles/filter.h&gt;
#include &lt;simple-tiles/layer.h&gt;

int
main(){
  simplet_map_t *map = simplet_map_new();
  simplet_map_set_srs(map, "EPSG:3083");
  simplet_map_set_bgcolor(map, "#ffffff");
  simplet_map_set_bounds(map, -585080.885134, 6849466.721081, 4161303.603672, 9587780.816356);
  simplet_map_set_size(map, 423, 260);
  simplet_layer_t *layer = simplet_map_add_layer(map, "PG:dbname=simple_tiles_roads");
  simplet_filter_t *filter = simplet_layer_add_filter(layer, "select * from roads");
  simplet_filter_add_style(filter, "stroke", "#11111166");
  simplet_filter_add_style(filter, "line-join", "round");
  simplet_filter_add_style(filter, "weight", "0.1");

  simplet_map_render_to_png(map, "./out.png");
  simplet_map_free(map);
}
</pre>
    <p>
      Another example is the repo's <a href="https://github.com/propublica/simple-tiles/blob/master/test/api.c">test/api.c</a>
      file.
    </p>

    <h2 id="map">Maps</h2>
    <p>
      The <tt>simplet_map_t</tt> structure is the root of the Simple Tiles heirarchy
      and has methods that set and get information on the final output.
    </p>

    <h4 id="simplet_map_new"><code>simplet_map_t* simplet_map_new()</code></h4>
    <p>
      Allocates and returns a pointer to a new instance of <tt>simplet_map_t</tt>.
      Returns <tt>NULL</tt> or the instance; the new instance should be freed
      with <tt>simplet_map_free</tt>.
    </p>

    <h4 id="simplet_map_free"><code>void simplet_map_free(simplet_map_t *map)</code></h4>
    <p>
      Deallocates the memory allocated for a particular <tt>simplet_map_t</tt>,
      and its child structures. This should be the only deallocation function
      you should need.
    </p>

    <h4 id="simplet_map_set_srs"><code>simplet_status_t simplet_map_set_srs(simplet_map_t *map, const char *proj)</code></h4>


    <p><em>Simple Tiles is a project of ProPublica.</em></p>
  </body>
</html>
